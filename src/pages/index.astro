---
import Layout from '@/layouts/Layout.astro';
import SearchBar from '@/components/SearchBar.astro';
import SearchScript from '@/components/SearchScript.astro';
import TrendingCard from '@/components/TrendingCard.astro';
import LazyMediaCard from '@/components/LazyMediaCard.astro';
import { fetchTrendingMedia, fetchAllMedia } from '@/lib/media';

// Set cache header
Astro.response.headers.set('Cache-Control', 'public, max-age=3600');

// Fetch trending items (top 8 from TMDB's trending API)
const trendingItems = await fetchTrendingMedia(8);

// Fetch recommended items (popular movies + TV shows)
const recommendedItems = await fetchAllMedia(12, 12);
---

<Layout title="Home - Entertainment Web App">
	<div class="w-full max-w-[1440px] mx-auto">
		<SearchBar />

		<section class="mb-6 md:mb-10 trending-section">
			<h2 class="text-xl md:text-[32px] font-light tracking-tight md:tracking-[-0.5px] mb-4 md:mb-6 text-pure-white">Trending</h2>
			<div class="flex gap-4 md:gap-10 overflow-x-auto overflow-y-hidden pb-4 scrollbar-none [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden">
				{trendingItems.map((item) => (
					<TrendingCard
						title={item.title}
						thumbnail={item.thumbnail.trending || item.thumbnail.regular}
						year={item.year}
						category={item.category as "Movie" | "TV Series"}
						rating={item.rating}
						isBookmarked={item.isBookmarked}
					/>
				))}
			</div>
		</section>

		<section class="mb-8">
			<h2 class="text-xl md:text-[32px] font-light tracking-tight md:tracking-[-0.5px] mb-4 md:mb-6 text-pure-white">Recommended for you</h2>
			<div class="grid grid-cols-2 gap-4 md:grid-cols-3 md:gap-y-6 md:gap-x-8 lg:grid-cols-4 lg:gap-y-8 lg:gap-x-10">
				{recommendedItems.map((item, index) => (
					<LazyMediaCard
						title={item.title}
						thumbnail={item.thumbnail.regular}
						year={item.year}
						category={item.category as "Movie" | "TV Series"}
						rating={item.rating}
						isBookmarked={item.isBookmarked}
						index={index}
					/>
				))}
			</div>
		</section>
	</div>

	<SearchScript category={undefined} />
</Layout>
